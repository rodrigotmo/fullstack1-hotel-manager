{% extends 'base.html' %} {% block content %}
<div class="container mt-5">
  <h1 class="text-center my-4">Lista de Reservas</h1>

  <div class="mb-4 text-center">
    <a href="{% url 'reserva_inicial' %}" class="btn btn-success mb-4">Novo</a>
    <input type="text" id="searchInput" class="form-control w-50 mx-auto"
      placeholder="Buscar por cliente, quarto ou id..." />
    <div class="mt-3">
      <a href="{% url 'reservas' %}" class="btn btn-primary mb-4">Reservas Ativas</a>
      <a href="{% url 'reservas_canceladas' %}" class="btn btn-danger mb-4">Reservas Canceladas</a>
      <a href="{% url 'reservas_finalizadas' %}" class="btn btn-info mb-4">Reservas Finalizadas</a>
    </div>

  </div>

  <div class="row justify-content-center">
    <div class="col-md-13">
      <div class="table-responsive">
        <table class="table table-striped table-bordered text-center custom-table">
          <thead class="bg-dark text-white">
            <tr>
              <th>ID</th>
              <th>Cliente</th>
              <th>Quarto</th>
              <th>Status</th>
              <th>Tarifa</th>
              <th>Data de Criação</th>
              <th>Data de Início</th>
              <th>Data de Fim</th>
              <th>Data de Check-in</th>
              <th>Data de Check-out</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody class="text-dark">
            {% for reserva in reservas %}
            <tr>
              <td>{{ reserva.id }}</td>
              <td><a href="{% url 'editar_cliente' reserva.cliente_id%}?callback=reservas">{{ reserva.cliente }}</a></td>
              <td>{{ reserva.quarto }}</td>
              <td>
                {% if reserva.status_reserva.nome_status_reserva == 'Cancelada' %}
                  {{ reserva.status_reserva }} em {{ reserva.data_cancelamento }}
                {% else %}
                  {{ reserva.status_reserva }}
                {% endif %}              
              </td>
              <td>{{ reserva.tarifa_tipo_quarto }}</td>
              <td>{{ reserva.data_reserva_criada }}</td>
              <td>{{ reserva.data_reserva_previsao_inicio }}</td>
              <td>{{ reserva.data_reserva_previsao_fim }}</td>
              <td>
                {% if reserva.data_check_in %}
                {{ reserva.data_check_in }}
                {% elif reserva.status_reserva.nome_status_reserva != 'Cancelada' and reserva.status_reserva.nome_status_reserva != 'Finalizada' %}
                <a href="{% url 'checkin' reserva.id %}" class="btn btn-primary btn-sm" href="">Check-in</a>
                {% endif %}
              </td>
              <td>
                {% if reserva.data_check_out %}
                {{ reserva.data_check_out }}
                {% elif reserva.status_reserva.nome_status_reserva != 'Cancelada' and reserva.status_reserva.nome_status_reserva != 'Finalizada' %}
                <a href="{% url 'checkout' reserva.id %}" class="btn btn-primary btn-sm" href="">Check-out</a>
                {% endif %}
              </td>
              <td>
                {% if reserva.status_reserva.nome_status_reserva == 'Reservada' %}
                <a href="{% url 'cancelar_reserva' reserva.id %}" class="btn btn-primary btn-sm" href="">Cancelar</a>
                {% endif %}
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="13">Nenhuma reserva encontrada.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<script>
  document.getElementById('searchInput').addEventListener('keyup', function () {
    let filter = this.value.toLowerCase()
    let rows = document.querySelectorAll('.custom-table tbody tr')

    rows.forEach(function (row) {
      let cells = row.getElementsByTagName('td')
      let match = false

      for (let i = 0; i < cells.length; i++) {
        if (cells[i].textContent.toLowerCase().includes(filter)) {
          match = true
          break
        }
      }

      if (match) {
        row.style.display = ''
      } else {
        row.style.display = 'none'
      }
    })
  })
</script>
{% endblock %}